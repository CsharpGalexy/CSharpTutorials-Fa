
## فهرست مطالب

1. [مقدمه](#1-مقدمه)  
2. [تعریف سازنده استاتیک](#2-تعریف-سازنده-استاتیک)  
3. [ویژگی‌های کلیدی سازنده‌های استاتیک](#3-ویژگی‌های-کلیدی-سازنده‌های-استاتیک)  
4. [تفاوت سازنده استاتیک با سازنده معمولی](#4-تفاوت-سازنده-استاتیک-با-سازنده-معمولی)  
5. [زمان اجرای سازنده استاتیک](#5-زمان-اجرای-سازنده-استاتیک)  
6. [محدودیت‌ها و قوانین](#6-محدودیت‌ها-و-قوانین)  
7. [کاربردهای رایج](#7-کاربردهای-رایج)  
8. [مثال‌های عملی](#8-مثال‌های-عملی)  
9. [نکات بهینه‌سازی و بهترین روش‌ها (Best Practices)](#9-نکات-بهینه‌سازی-و-بهترین-روش‌ها-best-practices)  
10. [منابع معتبر](#10-منابع-معتبر)

---

## 1. مقدمه

در برنامه‌نویسی شیء‌گرا (OOP)، **سازنده‌ها (Constructors)** نقش اساسی در مقداردهی اولیه اشیاء دارند. در C#، علاوه بر سازنده‌های معمولی، **سازنده‌های استاتیک (Static Constructors)** نیز وجود دارند که برای مقداردهی اولیه **اعضای استاتیک** یک کلاس استفاده می‌شوند. این نوع سازنده‌ها در زمان بارگذاری کلاس (Class Loading) توسط CLR (Common Language Runtime) فراخوانی می‌شوند و تنها یک‌بار اجرا می‌شوند.

---

## 2. تعریف سازنده استاتیک

سازنده استاتیک یک متد خاص در کلاس است که:

- بدون هیچ **مُدیفایر دسترسی** (مثل `public` یا `private`) تعریف می‌شود (البته می‌توان `private` گذاشت، اما بی‌معنی است چون به هرحال قابل دسترسی نیست).
- **بدون پارامتر** است.
- با کلمه کلیدی `static` مشخص می‌شود.
- **هیچ‌گاه به صورت دستی فراخوانی نمی‌شود** — CLR آن را در زمان مناسب اجرا می‌کند.

### سینتکس:

```csharp
static ClassName()
{
    // کد مقداردهی اعضای استاتیک
}
```

---

## 3. ویژگی‌های کلیدی سازنده‌های استاتیک

| ویژگی | توضیح |
|--------|--------|
| **اجرا فقط یک‌بار** | تنها یک‌بار در طول عمر برنامه اجرا می‌شود. |
| **بدون پارامتر** | نمی‌تواند پارامتر داشته باشد. |
| **بدون مُدیفایر دسترسی** | نمی‌تواند `public`، `private` یا هر مُدیفایر دیگری داشته باشد. |
| **غیرقابل ارث‌بری** | سازنده استاتیک در کلاس‌های فرزند ارث‌بری نمی‌شود. |
| **غیرقابل فراخوانی دستی** | نمی‌توان آن را مستقیماً فراخوانی کرد. |

---

## 4. تفاوت سازنده استاتیک با سازنده معمولی

| ویژگی | سازنده استاتیک | سازنده معمولی |
|--------|------------------|----------------|
| زمان اجرا | هنگام بارگذاری کلاس (قبل از اولین استفاده) | هنگام ایجاد هر نمونه جدید |
| تعداد اجرا | فقط یک‌بار | به ازای هر نمونه |
| هدف | مقداردهی اعضای **استاتیک** | مقداردهی اعضای **نمونه (instance)** |
| پارامتر | ندارد | می‌تواند پارامتر داشته باشد |
| مُدیفایر دسترسی | ندارد | می‌تواند داشته باشد |

---

## 5. زمان اجرای سازنده استاتیک

سازنده استاتیک **قبل از اولین دسترسی به هر عضو استاتیک یا ایجاد اولین نمونه از کلاس** اجرا می‌شود. این زمان توسط CLR بهینه‌سازی شده و ممکن است حتی زودتر از آنچه انتظار دارید اتفاق بیفتد (به دلیل JIT compilation).

> ⚠️ **نکته مهم**: اگر کلاس حاوی عضو استاتیکی نباشد، ممکن است CLR سازنده استاتیک را اصلاً اجرا نکند (بهینه‌سازی JIT).

---

## 6. محدودیت‌ها و قوانین

- سازنده استاتیک **نمی‌تواند پارامتر داشته باشد**.
- **نمی‌تواند مُدیفایر دسترسی** داشته باشد (حتی `private` بی‌معنی است).
- **نمی‌تواند از `this` یا `base`** استفاده کند (چون مربوط به نمونه نیست).
- **نمی‌تواند از آرگومان‌های خط فرمان** استفاده کند.
- در نسخه‌های C# قبل از 10، نمی‌توانست در ساختارها (structs) تعریف شود، اما اکنون این محدودیت برداشته شده است.

---

## 7. کاربردهای رایج

1. **مقداردهی اولیه فیلدهای استاتیک پیچیده** (مثل خواندن از فایل یا پایگاه داده).
2. **ثبت سرویس‌ها یا کامپوننت‌ها** در زمان راه‌اندازی برنامه.
3. **پیکربندی یک‌بار مصرف** برای کل کلاس (مثل تنظیمات لاگینگ).
4. **ایجاد نمونه‌های Singleton** (در برخی پیاده‌سازی‌ها).

---

## 8. مثال‌های عملی

### مثال ۱: مقداردهی فیلد استاتیک

```csharp
public class DatabaseConfig
{
    public static string ConnectionString { get; private set; }

    static DatabaseConfig()
    {
        // خواندن از فایل config
        ConnectionString = System.IO.File.ReadAllText("config.txt");
        Console.WriteLine("سازنده استاتیک اجرا شد.");
    }
}

// استفاده
Console.WriteLine(DatabaseConfig.ConnectionString); // سازنده استاتیک اجرا می‌شود
```

### مثال ۲: تفاوت با سازنده معمولی

```csharp
public class Counter
{
    public static int InstanceCount = 0;
    public int Id;

    static Counter()
    {
        Console.WriteLine("سازنده استاتیک اجرا شد.");
    }

    public Counter()
    {
        Id = ++InstanceCount;
        Console.WriteLine($"سازنده معمولی برای نمونه {Id} اجرا شد.");
    }
}

// تست
var c1 = new Counter(); // ابتدا سازنده استاتیک، سپس معمولی
var c2 = new Counter(); // فقط سازنده معمولی
```

**خروجی:**
```
سازنده استاتیک اجرا شد.
سازنده معمولی برای نمونه 1 اجرا شد.
سازنده معمولی برای نمونه 2 اجرا شد.
```

---

## 9. نکات بهینه‌سازی و بهترین روش‌ها (Best Practices)

- ✅ **از سازنده استاتیک فقط برای مقداردهی اعضای استاتیک استفاده کنید**.
- ❌ **کد سنگین یا بلاک‌کننده (مثل I/O طولانی) را در آن قرار ندهید** — ممکن است راه‌اندازی برنامه را کند کند.
- ✅ **خطاها را مدیریت کنید**: اگر سازنده استاتیک استثنا پرتاب کند، کلاس برای همیشه "خراب" می‌شود و دیگر قابل استفاده نیست.
- ✅ **برای کدهای راه‌اندازی یک‌بار مصرف، از `Lazy<T>` یا الگوی Singleton نیز در نظر بگیرید** — گاهی انعطاف‌پذیرتر هستند.

---

## 10. منابع معتبر

1. **Microsoft Learn – Static Constructors**  
   [https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/static-constructors](https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/static-constructors)

2. **C# Language Specification (ECMA-334)**  
   Section 15.12: Static constructors  
   [https://www.ecma-international.org/publications-and-standards/standards/ecma-334/](https://www.ecma-international.org/publications-and-standards/standards/ecma-334/)

3. **Jon Skeet – C# in Depth** (Chapter on Static Members)  
   Manning Publications, 4th Edition  
   [https://livebook.manning.com/book/c-sharp-in-depth-fourth-edition](https://livebook.manning.com/book/c-sharp-in-depth-fourth-edition)

4. **Stack Overflow – When is a static constructor called in C#?**  
   [https://stackoverflow.com/questions/1563134/when-is-a-static-constructor-called-in-c](https://stackoverflow.com/questions/1563134/when-is-a-static-constructor-called-in-c)

5. **.NET Runtime Behavior – Type Initialization**  
   [https://learn.microsoft.com/en-us/dotnet/standard/design-guidelines/type-constructor-guidelines](https://learn.microsoft.com/en-us/dotnet/standard/design-guidelines/type-constructor-guidelines)

---